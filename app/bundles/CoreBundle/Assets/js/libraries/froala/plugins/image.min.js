/*!
 * froala_editor v2.4.2 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2017 Froala Labs
 */

!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(t,a){return void 0===a&&(a="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(a),a}:e(jQuery)}(function(e){e.extend(e.FE.POPUP_TEMPLATES,{"image.insert":"[_BUTTONS_][_UPLOAD_LAYER_][_BY_URL_LAYER_][_PROGRESS_BAR_]","image.edit":"[_BUTTONS_]","image.alt":"[_BUTTONS_][_ALT_LAYER_]","image.size":"[_BUTTONS_][_SIZE_LAYER_]"}),e.extend(e.FE.DEFAULTS,{imageInsertButtons:["imageBack","|","imageUpload","imageByURL"],imageEditButtons:["imageReplace","imageAlign","imageRemove","|","imageLink","linkOpen","linkEdit","linkRemove","-","imageDisplay","imageStyle","imageAlt","imageSize"],imageAltButtons:["imageBack","|"],imageSizeButtons:["imageBack","|"],imageUploadURL:"https://i.froala.com/upload",imageUploadParam:"file",imageUploadParams:{},imageUploadToS3:!1,imageUploadMethod:"POST",imageMaxSize:10485760,imageAllowedTypes:["jpeg","jpg","png","gif","svg+xml"],imageResize:!0,imageResizeWithPercent:!1,imageRoundPercent:!1,imageDefaultWidth:300,imageDefaultAlign:"center",imageDefaultDisplay:"block",imageSplitHTML:!1,imageStyles:{"ft-rounded":"Rounded","fr-bordered":"Bordered"},imageMove:!0,imageMultipleStyles:!0,imageTextNear:!0,imagePaste:!0,imagePasteProcess:!1,imageMinWidth:16,imageOutputSize:!1,imageDefaultMargin:5}),e.FE.PLUGINS.image=function(t){var a,i,r,s,n,o,l=!1,f=1,d=2,g=3,p=4,u=5,c=6,m={};function h(){var e=t.popups.get("image.insert").find(".fr-image-by-url-layer input");e.val(""),a&&e.val(a.attr("src")),e.trigger("change")}function v(){var e=t.popups.get("image.edit");if(e||(e=x()),e){t.popups.setContainer("image.edit",t.$sc),t.popups.refresh("image.edit");var i=a.offset().left+a.outerWidth()/2,r=a.offset().top+a.outerHeight();t.popups.show("image.edit",i,r,a.outerHeight())}}function b(){k()}function y(){for(var a,i="IMG"==t.el.tagName?[t.el]:t.el.querySelectorAll("img"),r=0;r<i.length;r++){var s=e(i[r]);!t.opts.htmlUntouched&&t.opts.useClasses?t.opts.imageTextNear||s.removeClass("fr-dii").addClass("fr-dib"):t.opts.htmlUntouched||t.opts.useClasses||(t.opts.imageEditButtons.indexOf("imageAlign")>=0||t.opts.imageEditButtons.indexOf("imageDisplay")>=0)&&(oe(a=s,a.hasClass("fr-dib")?"block":a.hasClass("fr-dii")?"inline":null,a.hasClass("fr-fil")?"left":a.hasClass("fr-fir")?"right":le(a)),a.removeClass("fr-dib fr-dii fr-fir fr-fil")),t.opts.iframe&&s.on("load",t.size.syncIframe)}}function E(){var a,i=Array.prototype.slice.call(t.el.querySelectorAll("img")),r=[];for(a=0;a<i.length;a++)r.push(i[a].getAttribute("src")),e(i[a]).toggleClass("fr-draggable",t.opts.imageMove),""===i[a].getAttribute("class")&&i[a].removeAttribute("class"),""===i[a].getAttribute("style")&&i[a].removeAttribute("style");if(n)for(a=0;a<n.length;a++)r.indexOf(n[a].getAttribute("src"))<0&&t.events.trigger("image.removed",[e(n[a])]);n=i}function w(){i||function(){var r;t.shared.$image_resizer?(i=t.shared.$image_resizer,s=t.shared.$img_overlay,t.events.on("destroy",function(){i.removeClass("fr-active").appendTo(e("body"))},!0)):(t.shared.$image_resizer=e('<div class="fr-image-resizer"></div>'),i=t.shared.$image_resizer,t.events.$on(i,"mousedown",function(e){e.stopPropagation()},!0),t.opts.imageResize&&(i.append(C("nw")+C("ne")+C("sw")+C("se")),t.shared.$img_overlay=e('<div class="fr-image-overlay"></div>'),s=t.shared.$img_overlay,r=i.get(0).ownerDocument,e(r).find("body").append(s)));t.events.on("shared.destroy",function(){i.html("").removeData().remove(),i=null,t.opts.imageResize&&(s.remove(),s=null)},!0),t.helpers.isMobile()||t.events.$on(e(t.o_win),"resize",function(){a&&!a.hasClass("fr-uploading")?ie(!0):a&&(w(),de(),I(!1))});if(t.opts.imageResize){r=i.get(0).ownerDocument,t.events.$on(i,t._mousedown,".fr-handler",A),t.events.$on(e(r),t._mousemove,R),t.events.$on(e(r.defaultView||r.parentWindow),t._mouseup,S),t.events.$on(s,"mouseleave",S);var n=1,o=null,l=0;t.events.on("keydown",function(i){if(a){var r=-1!=navigator.userAgent.indexOf("Mac OS X")?i.metaKey:i.ctrlKey,s=i.which;(s!==o||i.timeStamp-l>200)&&(n=1),(s==e.FE.KEYCODE.EQUALS||t.browser.mozilla&&s==e.FE.KEYCODE.FF_EQUALS)&&r&&!i.altKey?n=q.call(this,i,1,1,n):(s==e.FE.KEYCODE.HYPHEN||t.browser.mozilla&&s==e.FE.KEYCODE.FF_HYPHEN)&&r&&!i.altKey?n=q.call(this,i,2,-1,n):t.keys.ctrlKey(i)||s!=e.FE.KEYCODE.ENTER||(a.before("<br>"),F(a)),o=s,l=i.timeStamp}},!0),t.events.on("keyup",function(){n=1})}}();var r=t.$wp||t.$sc;r.append(i),i.data("instance",t);var n=r.scrollTop()-("static"!=r.css("position")?r.offset().top:0),o=r.scrollLeft()-("static"!=r.css("position")?r.offset().left:0);o-=t.helpers.getPX(r.css("border-left-width")),n-=t.helpers.getPX(r.css("border-top-width")),t.$el.is("img")&&(n=0,o=0),i.css("top",(t.opts.iframe?a.offset().top:a.offset().top+n)-1).css("left",(t.opts.iframe?a.offset().left:a.offset().left+o)-1).css("width",a.get(0).getBoundingClientRect().width).css("height",a.get(0).getBoundingClientRect().height).addClass("fr-active")}function C(e){return'<div class="fr-handler fr-h'+e+'"></div>'}function A(n){if(!t.core.sameInstance(i))return!0;if(n.preventDefault(),n.stopPropagation(),t.$el.find("img.fr-error").left)return!1;t.undo.canDo()||t.undo.saveStep(),(r=e(this)).data("start-x",n.pageX||n.originalEvent.touches[0].pageX),r.data("start-width",a.width()),r.data("start-height",a.height());var o=a.width();if(t.opts.imageResizeWithPercent){var l=a.parentsUntil(t.$el,t.html.blockTagsQuery()).get(0)||t.el;a.css("width",(o/e(l).outerWidth()*100).toFixed(2)+"%")}else a.css("width",o);s.show(),t.popups.hideAll(),ne()}function R(s){if(!t.core.sameInstance(i))return!0;if(r&&a){if(s.preventDefault(),t.$el.find("img.fr-error").left)return!1;var n=s.pageX||(s.originalEvent.touches?s.originalEvent.touches[0].pageX:null);if(!n)return!1;var o=n-r.data("start-x"),l=r.data("start-width");if((r.hasClass("fr-hnw")||r.hasClass("fr-hsw"))&&(o=0-o),t.opts.imageResizeWithPercent){var f=a.parentsUntil(t.$el,t.html.blockTagsQuery()).get(0)||t.el;l=((l+o)/e(f).outerWidth()*100).toFixed(2),t.opts.imageRoundPercent&&(l=Math.round(l)),a.css("width",l+"%"),a.css("height","").removeAttr("height")}else l+o>=t.opts.imageMinWidth&&a.css("width",l+o),a.css("height",r.data("start-height")*a.width()/r.data("start-width"));w(),t.events.trigger("image.resize",[pe()])}}function S(e){if(!t.core.sameInstance(i))return!0;if(r&&a){if(e&&e.stopPropagation(),t.$el.find("img.fr-error").left)return!1;r=null,s.hide(),w(),v(),t.undo.saveStep(),t.events.trigger("image.resizeEnd",[pe()])}}function D(e,i){t.edit.on(),a&&a.addClass("fr-error"),function(e){I();var a=t.popups.get("image.insert").find(".fr-image-progress-bar-layer");a.addClass("fr-error");var i=a.find("h3");i.text(e),t.events.disableBlur(),i.focus()}(t.language.translate("Something went wrong. Please try again.")),t.events.trigger("image.error",[{code:e,message:m[e]},i])}function x(e){if(e)return t.$wp&&t.events.$on(t.$wp,"scroll",function(){a&&t.popups.isVisible("image.edit")&&(t.events.disableBlur(),F(a))}),!0;var i="";if(t.opts.imageEditButtons.length>0){i+='<div class="fr-buttons">',i+=t.button.buildList(t.opts.imageEditButtons);var r={buttons:i+="</div>"};return t.popups.create("image.edit",r)}return!1}function I(e){var i=t.popups.get("image.insert");if(i||(i=K()),i.find(".fr-layer.fr-active").removeClass("fr-active").addClass("fr-pactive"),i.find(".fr-image-progress-bar-layer").addClass("fr-active"),i.find(".fr-buttons").hide(),a){t.popups.setContainer("image.insert",t.$sc);var r=a.offset().left+a.width()/2,s=a.offset().top+a.height();t.popups.show("image.insert",r,s,a.outerHeight())}void 0===e&&U("Uploading",0)}function k(e){var i=t.popups.get("image.insert");if(i&&(i.find(".fr-layer.fr-pactive").addClass("fr-active").removeClass("fr-pactive"),i.find(".fr-image-progress-bar-layer").removeClass("fr-active"),i.find(".fr-buttons").show(),e||t.$el.find("img.fr-error").length)){if(t.events.focus(),t.$el.find("img.fr-error").length&&(t.$el.find("img.fr-error").remove(),t.undo.saveStep(),t.undo.run(),t.undo.dropRedo()),!t.$wp&&a){var r=a;ie(!0),t.selection.setAfter(r.get(0)),t.selection.restore()}t.popups.hide("image.insert")}}function U(e,a){var i=t.popups.get("image.insert");if(i){var r=i.find(".fr-image-progress-bar-layer");r.find("h3").text(e+(a?" "+a+"%":"")),r.removeClass("fr-error"),a?(r.find("div").removeClass("fr-indeterminate"),r.find("div > span").css("width",a+"%")):r.find("div").addClass("fr-indeterminate")}}function F(e){ae.call(e.get(0))}function $(){var a=e(this);t.popups.hide("image.insert"),a.removeClass("fr-uploading"),a.next().is("br")&&a.next().remove(),F(a),t.events.trigger("image.loaded",[a])}function B(e,a,i,r,s){t.edit.off(),U("Loading image"),a&&(e=t.helpers.sanitizeURL(e));var n=new Image;n.onload=function(){var a,n;if(r){t.undo.canDo()||r.hasClass("fr-uploading")||t.undo.saveStep();var o=r.data("fr-old-src");t.$wp?((a=r.clone().removeData("fr-old-src").removeClass("fr-uploading")).off("load"),o&&r.attr("src",o),r.replaceWith(a)):a=r;for(var l=a.get(0).attributes,f=0;f<l.length;f++){var d=l[f];0===d.nodeName.indexOf("data-")&&a.removeAttr(d.nodeName)}if(void 0!==i)for(n in i)i.hasOwnProperty(n)&&"link"!=n&&a.attr("data-"+n,i[n]);a.on("load",$),a.attr("src",e),t.edit.on(),E(),t.undo.saveStep(),t.$el.blur(),t.events.trigger(o?"image.replaced":"image.inserted",[a,s])}else a=P(e,i,$),E(),t.undo.saveStep(),t.events.trigger("image.inserted",[a,s])},n.onerror=function(){D(f)},I("Loading image"),n.src=e}function T(a){U("Loading image");var i=this.status,r=this.response,s=this.responseXML,n=this.responseText;try{if(t.opts.imageUploadToS3)if(201==i){var o=function(a){try{var i=e(a).find("Location").text(),r=e(a).find("Key").text();return!1===t.events.trigger("image.uploadedToS3",[i,r,a],!0)?(t.edit.on(),!1):i}catch(e){return D(p,a),!1}}(s);o&&B(o,!1,[],a,r||s)}else D(p,r||s);else if(i>=200&&i<300){var l=function(a){try{if(!1===t.events.trigger("image.uploaded",[a],!0))return t.edit.on(),!1;var i=e.parseJSON(a);return i.link?i:(D(d,a),!1)}catch(e){return D(p,a),!1}}(n);l&&B(l.link,!1,l,a,r||n)}else D(g,r||n)}catch(e){D(p,r||n)}}function O(){D(p,this.response||this.responseText||this.responseXML)}function M(e){e.lengthComputable&&U("Uploading",e.loaded/e.total*100|0)}function P(a,i,r){var s,n="";if(i&&void 0!==i)for(s in i)i.hasOwnProperty(s)&&"link"!=s&&(n+=" data-"+s+'="'+i[s]+'"');var o=t.opts.imageDefaultWidth;o&&"auto"!=o&&(o+=t.opts.imageResizeWithPercent?"%":"px");var l=e('<img src="'+a+'"'+n+(o?' style="width: '+o+';"':"")+">");return oe(l,t.opts.imageDefaultDisplay,t.opts.imageDefaultAlign),l.on("load",r),t.edit.on(),t.events.focus(!0),t.selection.restore(),t.undo.saveStep(),t.opts.imageSplitHTML?t.markers.split():t.markers.insert(),t.$el.find(".fr-marker").replaceWith(l),t.html.wrap(),t.selection.clear(),l}function N(){t.edit.on(),k(!0)}function L(i){if(void 0!==i&&i.length>0){if(!1===t.events.trigger("image.beforeUpload",[i]))return!1;var r,s=i[0];if(s.size>t.opts.imageMaxSize)return D(u),!1;if(t.opts.imageAllowedTypes.indexOf(s.type.replace(/image\//g,""))<0)return D(c),!1;if(t.drag_support.formdata&&(r=t.drag_support.formdata?new FormData:null),r){var n;if(!1!==t.opts.imageUploadToS3){r.append("key",t.opts.imageUploadToS3.keyStart+(new Date).getTime()+"-"+(s.name||"untitled")),r.append("success_action_status","201"),r.append("X-Requested-With","xhr"),r.append("Content-Type",s.type);for(n in t.opts.imageUploadToS3.params)t.opts.imageUploadToS3.params.hasOwnProperty(n)&&r.append(n,t.opts.imageUploadToS3.params[n])}for(n in t.opts.imageUploadParams)t.opts.imageUploadParams.hasOwnProperty(n)&&r.append(n,t.opts.imageUploadParams[n]);r.append(t.opts.imageUploadParam,s);var o=t.opts.imageUploadURL;t.opts.imageUploadToS3&&(o=t.opts.imageUploadToS3.uploadURL?t.opts.imageUploadToS3.uploadURL:"https://"+t.opts.imageUploadToS3.region+".amazonaws.com/"+t.opts.imageUploadToS3.bucket),function(i,r,s){function n(){var s=e(this);s.off("load"),s.addClass("fr-uploading"),s.next().is("br")&&s.next().remove(),t.placeholder.refresh(),s.is(a)||F(s),w(),I(),t.edit.off(),i.onload=function(){T.call(i,s)},i.onerror=O,i.upload.onprogress=M,i.onabort=N,s.off("abortUpload").on("abortUpload",function(){4!=i.readyState&&i.abort()}),i.send(r)}var o=new FileReader;o.addEventListener("load",function(){var e=o.result;if(o.result.indexOf("svg+xml")<0){for(var i=atob(o.result.split(",")[1]),r=[],s=0;s<i.length;s++)r.push(i.charCodeAt(s));e=window.URL.createObjectURL(new Blob([new Uint8Array(r)],{type:"image/jpeg"}))}a?(a.on("load",n),t.edit.on(),t.undo.saveStep(),a.data("fr-old-src",a.attr("src")),a.attr("src",e)):P(e,null,n)},!1),o.readAsDataURL(s)}(t.core.getXHR(o,t.opts.imageUploadMethod),r,s)}}}function z(a){var i=a.originalEvent.dataTransfer;if(i&&i.files&&i.files.length){var r=i.files[0];if(r&&r.type&&t.opts.imageAllowedTypes.indexOf(r.type.replace(/image\//g,""))>=0){t.markers.remove(),t.markers.insertAtPoint(a.originalEvent),t.$el.find(".fr-marker").replaceWith(e.FE.MARKERS),t.popups.hideAll();var s=t.popups.get("image.insert");return s||(s=K()),t.popups.setContainer("image.insert",t.$sc),t.popups.show("image.insert",a.originalEvent.pageX,a.originalEvent.pageY),I(),L(i.files),a.preventDefault(),a.stopPropagation(),!1}}}function _(){var a,i,r=t.selection.ranges(0);r.collapsed&&r.startContainer.nodeType==Node.ELEMENT_NODE&&(r.startContainer.childNodes.length==r.startOffset?(a=r.startContainer.childNodes[r.startOffset-1])&&"IMG"==a.tagName&&"block"==e(a).css("display")&&((i=t.node.blockParent(a))&&t.html.defaultTag()?i.nextSibling||(["TD","TH"].indexOf(i.tagName)<0?e(i).after("<"+t.html.defaultTag()+"><br>"+e.FE.MARKERS+"</"+t.html.defaultTag()+">"):e(a).after("<br>"+e.FE.MARKERS),t.selection.restore()):i||(e(a).after("<br>"+e.FE.MARKERS),t.selection.restore())):0===r.startOffset&&r.startContainer.childNodes.length>r.startOffset&&(a=r.startContainer.childNodes[r.startOffset])&&"IMG"==a.tagName&&"block"==e(a).css("display")&&((i=t.node.blockParent(a))&&t.html.defaultTag()?i.previousSibling||(["TD","TH"].indexOf(i.tagName)<0?e(i).before("<"+t.html.defaultTag()+"><br>"+e.FE.MARKERS+"</"+t.html.defaultTag()+">"):e(a).before("<br>"+e.FE.MARKERS),t.selection.restore()):i||(e(a).before(e.FE.MARKERS+"<br>"),t.selection.restore())))}function K(i){if(i)return t.popups.onRefresh("image.insert",h),t.popups.onHide("image.insert",b),!0;var r,s="";t.opts.imageInsertButtons.length>1&&(s='<div class="fr-buttons">'+t.button.buildList(t.opts.imageInsertButtons)+"</div>");var n=t.opts.imageInsertButtons.indexOf("imageUpload"),o=t.opts.imageInsertButtons.indexOf("imageByURL"),l="";n>=0&&(r=" fr-active",o>=0&&n>o&&(r=""),l='<div class="fr-image-upload-layer'+r+' fr-layer" id="fr-image-upload-layer-'+t.id+'"><strong>'+t.language.translate("Drop image")+"</strong><br>("+t.language.translate("or click")+')<div class="fr-form"><input type="file" accept="image/'+t.opts.imageAllowedTypes.join(", image/").toLowerCase()+'" tabIndex="-1" aria-labelledby="fr-image-upload-layer-'+t.id+'" role="button"></div></div>');var f="";o>=0&&(r=" fr-active",n>=0&&o>n&&(r=""),f='<div class="fr-image-by-url-layer'+r+' fr-layer" id="fr-image-by-url-layer-'+t.id+'"><div class="fr-input-line"><input id="fr-image-by-url-layer-text-'+t.id+'" type="text" placeholder="http://" tabIndex="1" aria-required="true"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageInsertByURL" tabIndex="2" role="button">'+t.language.translate("Insert")+"</button></div></div>");var d,g={buttons:s,upload_layer:l,by_url_layer:f,progress_bar:'<div class="fr-image-progress-bar-layer fr-layer"><h3 tabIndex="-1" class="fr-message">Uploading</h3><div class="fr-loader"><span class="fr-progress"></span></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-dismiss" data-cmd="imageDismissError" tabIndex="2" role="button">OK</button></div></div>'},p=t.popups.create("image.insert",g);return t.$wp&&t.events.$on(t.$wp,"scroll",function(){a&&t.popups.isVisible("image.insert")&&de()}),d=p,t.events.$on(d,"dragover dragenter",".fr-image-upload-layer",function(){return e(this).addClass("fr-drop"),!1}),t.events.$on(d,"dragleave dragend",".fr-image-upload-layer",function(){return e(this).removeClass("fr-drop"),!1}),t.events.$on(d,"drop",".fr-image-upload-layer",function(a){a.preventDefault(),a.stopPropagation(),e(this).removeClass("fr-drop");var i=a.originalEvent.dataTransfer;if(i&&i.files){var r=d.data("instance")||t;r.events.disableBlur(),r.image.upload(i.files),r.events.enableBlur()}}),t.events.$on(d,"change",'.fr-image-upload-layer input[type="file"]',function(){if(this.files){var a=d.data("instance")||t;a.events.disableBlur(),d.find("input:focus").blur(),a.events.enableBlur(),a.image.upload(this.files)}e(this).val("")}),p}function W(){a&&t.popups.get("image.alt").find("input").val(a.attr("alt")||"").trigger("change")}function H(){var e=t.popups.get("image.alt");e||(e=Y()),k(),t.popups.refresh("image.alt"),t.popups.setContainer("image.alt",t.$sc);var i=a.offset().left+a.width()/2,r=a.offset().top+a.height();t.popups.show("image.alt",i,r,a.outerHeight())}function Y(e){if(e)return t.popups.onRefresh("image.alt",W),!0;var i={buttons:'<div class="fr-buttons">'+t.button.buildList(t.opts.imageAltButtons)+"</div>",alt_layer:'<div class="fr-image-alt-layer fr-layer fr-active" id="fr-image-alt-layer-'+t.id+'"><div class="fr-input-line"><input id="fr-image-alt-layer-text-'+t.id+'" type="text" placeholder="'+t.language.translate("Alternate Text")+'" tabIndex="1"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetAlt" tabIndex="2" role="button">'+t.language.translate("Update")+"</button></div></div>"},r=t.popups.create("image.alt",i);return t.$wp&&t.events.$on(t.$wp,"scroll.image-alt",function(){a&&t.popups.isVisible("image.alt")&&H()}),r}function G(){if(a){var e=t.popups.get("image.size");e.find('input[name="width"]').val(a.get(0).style.width).trigger("change"),e.find('input[name="height"]').val(a.get(0).style.height).trigger("change")}}function j(){var e=t.popups.get("image.size");e||(e=X()),k(),t.popups.refresh("image.size"),t.popups.setContainer("image.size",t.$sc);var i=a.offset().left+a.width()/2,r=a.offset().top+a.height();t.popups.show("image.size",i,r,a.outerHeight())}function X(e){if(e)return t.popups.onRefresh("image.size",G),!0;var i={buttons:'<div class="fr-buttons">'+t.button.buildList(t.opts.imageSizeButtons)+"</div>",size_layer:'<div class="fr-image-size-layer fr-layer fr-active" id="fr-image-size-layer-'+t.id+'"><div class="fr-image-group"><div class="fr-input-line"><input id="fr-image-size-layer-width-'+t.id+'" type="text" name="width" placeholder="'+t.language.translate("Width")+'" tabIndex="1"></div><div class="fr-input-line"><input id="fr-image-size-layer-height'+t.id+'" type="text" name="height" placeholder="'+t.language.translate("Height")+'" tabIndex="1"></div></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetSize" tabIndex="2" role="button">'+t.language.translate("Update")+"</button></div></div>"},r=t.popups.create("image.size",i);return t.$wp&&t.events.$on(t.$wp,"scroll.image-size",function(){a&&t.popups.isVisible("image.size")&&j()}),r}function q(e,t,a,i){return e.pageX=t,A.call(this,e),e.pageX=e.pageX+a*Math.floor(Math.pow(1.1,i)),R.call(this,e),S.call(this,e),++i}function V(i){(i=i||a)&&!1!==t.events.trigger("image.beforeRemove",[i])&&(t.popups.hideAll(),ge(),ie(!0),t.undo.canDo()||t.undo.saveStep(),i.get(0)==t.el?i.removeAttr("src"):("A"==i.get(0).parentNode.tagName?(t.selection.setBefore(i.get(0).parentNode)||t.selection.setAfter(i.get(0).parentNode)||i.parent().after(e.FE.MARKERS),e(i.get(0).parentNode).remove()):(t.selection.setBefore(i.get(0))||t.selection.setAfter(i.get(0))||i.after(e.FE.MARKERS),i.remove()),t.html.fillEmptyBlocks(),t.selection.restore()),t.undo.saveStep())}function Q(i){var r=i.which;if(a&&(r==e.FE.KEYCODE.BACKSPACE||r==e.FE.KEYCODE.DELETE))return i.preventDefault(),i.stopPropagation(),V(),!1;if(a&&r==e.FE.KEYCODE.ESC){var s=a;return ie(!0),t.selection.setAfter(s.get(0)),t.selection.restore(),i.preventDefault(),!1}if(a&&(r==e.FE.KEYCODE.ARROW_LEFT||r==e.FE.KEYCODE.ARROW_RIGHT)){var n=a.get(0);return ie(!0),r==e.FE.KEYCODE.ARROW_LEFT?t.selection.setBefore(n):t.selection.setAfter(n),t.selection.restore(),i.preventDefault(),!1}return a&&r!=e.FE.KEYCODE.F10&&!t.keys.isBrowserAction(i)?(i.preventDefault(),i.stopPropagation(),!1):void 0}function J(e){if(e&&"IMG"==e.tagName)t.node.hasClass(e,"fr-uploading")||t.node.hasClass(e,"fr-error")?e.parentNode.removeChild(e):t.node.hasClass(e,"fr-draggable")&&e.classList.remove("fr-draggable");else if(e&&e.nodeType==Node.ELEMENT_NODE)for(var a=e.querySelectorAll("img.fr-uploading, img.fr-error, img.fr-draggable"),i=0;i<a.length;i++)J(a[i])}function Z(){t.opts.imagePaste?t.$el.find("img[data-fr-image-pasted]").each(function(i,r){if(t.opts.imagePasteProcess){var s=t.opts.imageDefaultWidth;s&&"auto"!=s&&(s+=t.opts.imageResizeWithPercent?"%":"px"),e(r).css("width",s),e(r).removeClass("fr-dii fr-dib fr-fir fr-fil").addClass((t.opts.imageDefaultDisplay?"fr-di"+t.opts.imageDefaultDisplay[0]:"")+(t.opts.imageDefaultAlign&&"center"!=t.opts.imageDefaultAlign?" fr-fi"+t.opts.imageDefaultAlign[0]:""))}if(0===r.src.indexOf("data:")){if(!1===t.events.trigger("image.beforePasteUpload",[r]))return!1;a=e(r),w(),v(),de(),I(),t.edit.off();for(var n=atob(e(r).attr("src").split(",")[1]),o=[],l=0;l<n.length;l++)o.push(n.charCodeAt(l));L([new Blob([new Uint8Array(o)],{type:"image/jpeg"})]),e(r).removeAttr("data-fr-image-pasted")}else 0!==r.src.indexOf("http")||0===r.src.indexOf("https://mail.google.com/mail")?(t.selection.save(),e(r).remove(),t.selection.restore()):e(r).removeAttr("data-fr-image-pasted")}):t.$el.find("img[data-fr-image-pasted]").remove()}function ee(e){if(e&&e.clipboardData&&e.clipboardData.items&&e.clipboardData.items[0]){var a=e.clipboardData.items[0].getAsFile();if(a){var i=new FileReader;return i.onload=function(e){var a=e.target.result,i=t.opts.imageDefaultWidth;i&&"auto"!=i&&(i+=t.opts.imageResizeWithPercent?"%":"px"),t.html.insert('<img data-fr-image-pasted="true" class="'+(t.opts.imageDefaultDisplay?"fr-di"+t.opts.imageDefaultDisplay[0]:"")+(t.opts.imageDefaultAlign&&"center"!=t.opts.imageDefaultAlign?" fr-fi"+t.opts.imageDefaultAlign[0]:"")+'" src="'+a+'"'+(i?' style="width: '+i+';"':"")+">"),t.events.trigger("paste.after")},i.readAsDataURL(a),!1}}}function te(e){return e=e.replace(/<img /gi,'<img data-fr-image-pasted="true" ')}function ae(i){if("false"==e(this).parents("[contenteditable]:not(.fr-element):not(body):first").attr("contenteditable"))return!0;if(i&&"touchend"==i.type&&o)return!0;if(i&&t.edit.isDisabled())return i.stopPropagation(),i.preventDefault(),!1;for(var r=0;r<e.FE.INSTANCES.length;r++)e.FE.INSTANCES[r]!=t&&e.FE.INSTANCES[r].events.trigger("image.hideResizer");t.toolbar.disable(),i&&(i.stopPropagation(),i.preventDefault()),t.helpers.isMobile()&&(t.events.disableBlur(),t.$el.blur(),t.events.enableBlur()),t.opts.iframe&&t.size.syncIframe(),a=e(this),ge(),w(),v(),t.selection.clear(),t.button.bulkRefresh(),t.events.trigger("video.hideResizer")}function ie(e){a&&(re||!0===e)&&(t.toolbar.enable(),i.removeClass("fr-active"),t.popups.hide("image.edit"),a=null,ne())}m[f]="Image cannot be loaded from the passed link.",m[d]="No link in upload response.",m[g]="Error during file upload.",m[p]="Parsing response failed.",m[u]="File is too large.",m[c]="Image file type is invalid.",m[7]="Files can be uploaded only to same domain in IE 8 and IE 9.";var re=!1;function se(){re=!0}function ne(){re=!1}function oe(e,a,i){!t.opts.htmlUntouched&&t.opts.useClasses?(e.removeClass("fr-fil fr-fir fr-dib fr-dii"),e.addClass("fr-fi"+i[0]+" fr-di"+a[0])):"inline"==a?(e.css({display:"inline-block",verticalAlign:"bottom",margin:t.opts.imageDefaultMargin}),"center"==i?e.css({float:"none",marginBottom:"",marginTop:"",maxWidth:"calc(100% - "+2*t.opts.imageDefaultMargin+"px)"}):"left"==i?e.css({float:"left",marginLeft:0,maxWidth:"calc(100% - "+t.opts.imageDefaultMargin+"px)"}):e.css({float:"right",marginRight:0,maxWidth:"calc(100% - "+t.opts.imageDefaultMargin+"px)"})):"block"==a&&(e.css({display:"block",float:"none",verticalAlign:"top",margin:t.opts.imageDefaultMargin+"px auto"}),"left"==i?e.css({marginLeft:0}):"right"==i&&e.css({marginRight:0}))}function le(e){if(void 0===e&&(e=a),e){if(e.hasClass("fr-fil"))return"left";if(e.hasClass("fr-fir"))return"right";if(e.hasClass("fr-dib")||e.hasClass("fr-dii"))return"center";var t=e.css("float");if(e.css("float","none"),"block"==e.css("display")){if(e.css("float",""),e.css("float")!=t&&e.css("float",t),0===parseInt(e.css("margin-left"),10))return"left";if(0===parseInt(e.css("margin-right"),10))return"right"}else{if(e.css("float",""),e.css("float")!=t&&e.css("float",t),"left"==e.css("float"))return"left";if("right"==e.css("float"))return"right"}}return"center"}function fe(e){void 0===e&&(e=a);var t=e.css("float");return e.css("float","none"),"block"==e.css("display")?(e.css("float",""),e.css("float")!=t&&e.css("float",t),"block"):(e.css("float",""),e.css("float")!=t&&e.css("float",t),"inline")}function de(){var e=t.popups.get("image.insert");e||(e=K()),t.popups.isVisible("image.insert")||(k(),t.popups.refresh("image.insert"),t.popups.setContainer("image.insert",t.$sc));var i=a.offset().left+a.width()/2,r=a.offset().top+a.height();t.popups.show("image.insert",i,r,a.outerHeight())}function ge(){if(a){t.selection.clear();var e=t.doc.createRange();e.selectNode(a.get(0)),t.selection.get().addRange(e)}}function pe(){return a}return{_init:function(){var i;t.events.$on(t.$el,t._mousedown,"IMG"==t.el.tagName?null:'img:not([contenteditable="false"])',function(a){if("false"==e(this).parents("[contenteditable]:not(.fr-element):not(body):first").attr("contenteditable"))return!0;t.helpers.isMobile()||t.selection.clear(),l=!0,t.popups.areVisible()&&t.events.disableBlur(),t.browser.msie&&(t.events.disableBlur(),t.$el.attr("contenteditable",!1)),t.draggable||a.preventDefault(),a.stopPropagation()}),t.events.$on(t.$el,t._mouseup,"IMG"==t.el.tagName?null:'img:not([contenteditable="false"])',function(a){if("false"==e(this).parents("[contenteditable]:not(.fr-element):not(body):first").attr("contenteditable"))return!0;l&&(l=!1,a.stopPropagation(),t.browser.msie&&(t.$el.attr("contenteditable",!0),t.events.enableBlur()))}),t.events.on("keyup",function(a){if(a.shiftKey&&""===t.selection.text().replace(/\n/g,"")){var i=t.selection.element(),r=t.selection.endElement();i&&"IMG"==i.tagName?F(e(i)):r&&"IMG"==r.tagName&&F(e(r))}},!0),t.events.on("drop",z),t.events.on("mousedown window.mousedown",se),t.events.on("window.touchmove",ne),t.events.on("mouseup window.mouseup",function(){if(a)return ie(),!1;ne()}),t.events.on("commands.mousedown",function(e){e.parents(".fr-toolbar").length>0&&ie()}),t.browser.edge||t.events.on("mouseup",_),t.events.on("blur image.hideResizer commands.undo commands.redo element.dropped",function(){l=!1,ie(!0)}),"IMG"==t.el.tagName&&t.$el.addClass("fr-view"),t.events.$on(t.$el,t.helpers.isMobile()&&!t.helpers.isWindowsPhone()?"touchend":"click","IMG"==t.el.tagName?null:'img:not([contenteditable="false"])',ae),t.helpers.isMobile()&&(t.events.$on(t.$el,"touchstart","IMG"==t.el.tagName?null:'img:not([contenteditable="false"])',function(){o=!1}),t.events.$on(t.$el,"touchmove",function(){o=!0})),t.$wp?(t.events.on("window.keydown keydown",Q,!0),t.events.on("keyup",function(t){if(t.which==e.FE.KEYCODE.ENTER)return!1},!0)):t.events.$on(t.$win,"keydown",Q),t.events.on("toolbar.esc",function(){if(a){if(t.$wp)t.events.disableBlur(),t.events.focus();else{var e=a;ie(!0),t.selection.setAfter(e.get(0)),t.selection.restore()}return!1}},!0),t.events.on("toolbar.focusEditor",function(){if(a)return!1},!0),t.events.on("window.cut window.copy",function(i){a&&t.popups.isVisible("image.edit")&&!t.popups.get("image.edit").find(":focus").length&&(ge(),e.FE.copied_text="\n",e.FE.copied_html=a.get(0).outerHTML,"copy"==i.type?setTimeout(function(){F(a)}):(ie(!0),t.undo.saveStep(),setTimeout(function(){t.undo.saveStep()},0)))},!0),t.events.$on(e(t.o_win),"keydown",function(t){var i=t.which;if(a&&i==e.FE.KEYCODE.BACKSPACE)return t.preventDefault(),!1}),t.events.$on(t.$win,"keydown",function(t){var i=t.which;a&&a.hasClass("fr-uploading")&&i==e.FE.KEYCODE.ESC&&a.trigger("abortUpload")}),t.events.on("destroy",function(){a&&a.hasClass("fr-uploading")&&a.trigger("abortUpload")}),t.events.on("paste.before",ee),t.events.on("paste.beforeCleanup",te),t.events.on("paste.after",Z),t.events.on("html.set",y),t.events.on("html.inserted",y),y(),t.events.on("destroy",function(){n=[]}),t.events.on("html.processGet",J),t.opts.imageOutputSize&&(t.events.on("html.beforeGet",function(){i=t.el.querySelectorAll("img");for(var a=0;a<i.length;a++){var r=i[a].style.width||e(i[a]).width(),s=i[a].style.height||e(i[a]).height();r&&i[a].setAttribute("width",(""+r).replace(/px/,"")),s&&i[a].setAttribute("height",(""+s).replace(/px/,""))}}),t.events.on("html.afterGet",function(){for(var e=0;e<i.length;e++)i[e].removeAttribute("width"),i[e].removeAttribute("height")})),t.opts.iframe&&t.events.on("image.loaded",t.size.syncIframe),t.$wp&&(E(),t.events.on("contentChanged",E)),t.events.$on(e(t.o_win),"orientationchange.image",function(){setTimeout(function(){a&&F(a)},100)}),x(!0),K(!0),X(!0),Y(!0),t.events.on("node.remove",function(e){if("IMG"==e.get(0).tagName)return V(e),!1})},showInsertPopup:function(){var e=t.$tb.find('.fr-command[data-cmd="insertImage"]'),a=t.popups.get("image.insert");if(a||(a=K()),k(),!a.hasClass("fr-active"))if(t.popups.refresh("image.insert"),t.popups.setContainer("image.insert",t.$tb),e.is(":visible")){var i=e.offset().left+e.outerWidth()/2,r=e.offset().top+(t.opts.toolbarBottom?10:e.outerHeight()-10);t.popups.show("image.insert",i,r,e.outerHeight())}else t.position.forSelection(a),t.popups.show("image.insert")},showLayer:function(e){var i,r,s=t.popups.get("image.insert");if(a||t.opts.toolbarInline)a&&(r=a.offset().top+a.outerHeight());else{var n=t.$tb.find('.fr-command[data-cmd="insertImage"]');i=n.offset().left+n.outerWidth()/2,r=n.offset().top+(t.opts.toolbarBottom?10:n.outerHeight()-10)}!a&&t.opts.toolbarInline&&(r=s.offset().top-t.helpers.getPX(s.css("margin-top")),s.hasClass("fr-above")&&(r+=s.outerHeight())),s.find(".fr-layer").removeClass("fr-active"),s.find(".fr-"+e+"-layer").addClass("fr-active"),t.popups.show("image.insert",i,r,a?a.outerHeight():0),t.accessibility.focusPopup(s)},refreshUploadButton:function(e){t.popups.get("image.insert").find(".fr-image-upload-layer").hasClass("fr-active")&&e.addClass("fr-active").attr("aria-pressed",!0)},refreshByURLButton:function(e){t.popups.get("image.insert").find(".fr-image-by-url-layer").hasClass("fr-active")&&e.addClass("fr-active").attr("aria-pressed",!0)},upload:L,insertByURL:function(){var e=t.popups.get("image.insert").find(".fr-image-by-url-layer input");e.val().length>0&&(I(),U("Loading image"),B(e.val(),!0,[],a),e.val(""),e.blur())},align:function(e){a.removeClass("fr-fir fr-fil"),!t.opts.htmlUntouched&&t.opts.useClasses?"left"==e?a.addClass("fr-fil"):"right"==e&&a.addClass("fr-fir"):oe(a,fe(),e),w(),v()},refreshAlign:function(e){a&&e.find("> *:first").replaceWith(t.icon.create("image-align-"+le()))},refreshAlignOnShow:function(e,t){a&&t.find('.fr-command[data-param1="'+le()+'"]').addClass("fr-active").attr("aria-selected",!0)},display:function(e){a.removeClass("fr-dii fr-dib"),!t.opts.htmlUntouched&&t.opts.useClasses?"inline"==e?a.addClass("fr-dii"):"block"==e&&a.addClass("fr-dib"):oe(a,e,le()),w(),v()},refreshDisplayOnShow:function(e,t){a&&t.find('.fr-command[data-param1="'+fe()+'"]').addClass("fr-active").attr("aria-selected",!0)},replace:de,back:function(){a?(t.events.disableBlur(),e(".fr-popup input:focus").blur(),F(a)):(t.events.disableBlur(),t.selection.restore(),t.events.enableBlur(),t.popups.hide("image.insert"),t.toolbar.showInline())},get:pe,insert:B,showProgressBar:I,remove:V,hideProgressBar:k,applyStyle:function(e,i,r){if(void 0===i&&(i=t.opts.imageStyles),void 0===r&&(r=t.opts.imageMultipleStyles),!a)return!1;if(!r){var s=Object.keys(i);s.splice(s.indexOf(e),1),a.removeClass(s.join(" "))}"object"==typeof i[e]?(a.removeAttr("style"),a.css(i[e].style)):a.toggleClass(e),F(a)},showAltPopup:H,showSizePopup:j,setAlt:function(e){if(a){var i=t.popups.get("image.alt");a.attr("alt",e||i.find("input").val()||""),i.find("input:focus").blur(),F(a)}},setSize:function(e,i){if(a){var r=t.popups.get("image.size");e=e||r.find('input[name="width"]').val()||"",i=i||r.find('input[name="height"]').val()||"";var s=/^[\d]+((px)|%)*$/g;e.match(s)&&a.css("width",e),i.match(s)&&a.css("height",i),r.find("input:focus").blur(),F(a)}},exitEdit:ie,edit:F}},e.FE.DefineIcon("insertImage",{NAME:"image"}),e.FE.RegisterShortcut(e.FE.KEYCODE.P,"insertImage",null,"P"),e.FE.RegisterCommand("insertImage",{title:"Insert Image",undo:!1,focus:!0,refreshAfterCallback:!1,popup:!0,callback:function(){this.popups.isVisible("image.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("image.insert")):this.image.showInsertPopup()},plugin:"image"}),e.FE.DefineIcon("imageUpload",{NAME:"upload"}),e.FE.RegisterCommand("imageUpload",{title:"Upload Image",undo:!1,focus:!1,toggle:!0,callback:function(){this.image.showLayer("image-upload")},refresh:function(e){this.image.refreshUploadButton(e)}}),e.FE.DefineIcon("imageByURL",{NAME:"link"}),e.FE.RegisterCommand("imageByURL",{title:"By URL",undo:!1,focus:!1,toggle:!0,callback:function(){this.image.showLayer("image-by-url")},refresh:function(e){this.image.refreshByURLButton(e)}}),e.FE.RegisterCommand("imageInsertByURL",{title:"Insert Image",undo:!0,refreshAfterCallback:!1,callback:function(){this.image.insertByURL()},refresh:function(e){this.image.get()?e.text(this.language.translate("Replace")):e.text(this.language.translate("Insert"))}}),e.FE.DefineIcon("imageDisplay",{NAME:"star"}),e.FE.RegisterCommand("imageDisplay",{title:"Display",type:"dropdown",options:{inline:"Inline",block:"Break Text"},callback:function(e,t){this.image.display(t)},refresh:function(e){this.opts.imageTextNear||e.addClass("fr-hidden")},refreshOnShow:function(e,t){this.image.refreshDisplayOnShow(e,t)}}),e.FE.DefineIcon("image-align",{NAME:"align-left"}),e.FE.DefineIcon("image-align-left",{NAME:"align-left"}),e.FE.DefineIcon("image-align-right",{NAME:"align-right"}),e.FE.DefineIcon("image-align-center",{NAME:"align-justify"}),e.FE.DefineIcon("imageAlign",{NAME:"align-justify"}),e.FE.RegisterCommand("imageAlign",{type:"dropdown",title:"Align",options:{left:"Align Left",center:"None",right:"Align Right"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',a=e.FE.COMMANDS.imageAlign.options;for(var i in a)a.hasOwnProperty(i)&&(t+='<li role="presentation"><a class="fr-command fr-title" tabIndex="-1" role="option" data-cmd="imageAlign" data-param1="'+i+'" title="'+this.language.translate(a[i])+'">'+this.icon.create("image-align-"+i)+'<span class="fr-sr-only">'+this.language.translate(a[i])+"</span></a></li>");return t+="</ul>"},callback:function(e,t){this.image.align(t)},refresh:function(e){this.image.refreshAlign(e)},refreshOnShow:function(e,t){this.image.refreshAlignOnShow(e,t)}}),e.FE.DefineIcon("imageReplace",{NAME:"exchange"}),e.FE.RegisterCommand("imageReplace",{title:"Replace",undo:!1,focus:!1,popup:!0,refreshAfterCallback:!1,callback:function(){this.image.replace()}}),e.FE.DefineIcon("imageRemove",{NAME:"trash"}),e.FE.RegisterCommand("imageRemove",{title:"Remove",callback:function(){this.image.remove()}}),e.FE.DefineIcon("imageBack",{NAME:"arrow-left"}),e.FE.RegisterCommand("imageBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.image.back()},refresh:function(e){this.image.get()||this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator").addClass("fr-hidden"))}}),e.FE.RegisterCommand("imageDismissError",{title:"OK",undo:!1,callback:function(){this.image.hideProgressBar(!0)}}),e.FE.DefineIcon("imageStyle",{NAME:"magic"}),e.FE.RegisterCommand("imageStyle",{title:"Style",type:"dropdown",html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=this.opts.imageStyles;for(var a in t)if(t.hasOwnProperty(a)){var i=t[a];"object"==typeof i&&(i=i.title),e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="imageStyle" data-param1="'+a+'">'+this.language.translate(i)+"</a></li>"}return e+="</ul>"},callback:function(e,t){this.image.applyStyle(t)},refreshOnShow:function(t,a){var i=this.image.get();i&&a.find(".fr-command").each(function(){var t=e(this).data("param1"),a=i.hasClass(t);e(this).toggleClass("fr-active",a).attr("aria-selected",a)})}}),e.FE.DefineIcon("imageAlt",{NAME:"info"}),e.FE.RegisterCommand("imageAlt",{undo:!1,focus:!1,popup:!0,title:"Alternate Text",callback:function(){this.image.showAltPopup()}}),e.FE.RegisterCommand("imageSetAlt",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.image.setAlt()}}),e.FE.DefineIcon("imageSize",{NAME:"arrows-alt"}),e.FE.RegisterCommand("imageSize",{undo:!1,focus:!1,popup:!0,title:"Change Size",callback:function(){this.image.showSizePopup()}}),e.FE.RegisterCommand("imageSetSize",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.image.setSize()}})});