{% if 'index' == tmpl %}
    {% extends 'MauticCoreBundle:Default:content.html.twig' %}
    {% set showDynamicFilters = report.getSettings.showDynamicFilters is defined and report.getSettings.showDynamicFilters is not empty %}
    {% set hideDateRangeFilter = report.getSettings.hideDateRangeFilter is defined and report.getSettings.hideDateRangeFilter is not empty %}
    {% set buttons = [] %}
    {% if data is not empty or graphs is not empty %}
        {% set buttons = buttons|merge({
                'attr': {
                    'target': '_new',
                    'data-toggle': '',
                    'class': 'btn btn-default btn-nospin',
                    'href': path(
                        'mautic_report_export',
                        {'objectId': report.getId(), 'format': 'html'}
                    ),
                },
                'btnText': 'mautic.form.result.export.html'|trans,
                'iconClass': 'fa fa-file-code-o',
            })
        %}
        {% if data is not empty %}
            {% set buttons = buttons|merge({
                'attr': {
                    'data-toggle': 'download',
                    'class': 'btn btn-default btn-nospin',
                    'href': path(
                        'mautic_report_export',
                        {'objectId': report.getId(), 'format': 'csv'}
                    ),
                },
                'btnText': 'mautic.form.result.export.csv'|trans,
                'iconClass': 'fa fa-file-text-o',
            })
            %}

            {% set buttons = buttons|merge({
                'attr': {
                    'data-toggle': 'download',
                    'class': 'btn btn-default btn-nospin',
                    'href': path(
                        'mautic_report_export',
                        {'objectId': report.getId(), 'format': 'xlsx'}
                    ),
                },
                'btnText': 'mautic.form.result.export.xlsx'|trans,
                'iconClass': 'fa fa-file-excel-o',
            })
            %}
        {% endif %}
    {% endif %}
{% endif %}
{% set header = 'mautic.report.report.header.view'|trans({'%name%': report.getName()|trans|escape }) %}
{% block mauticContent %}report{% endblock %}
{% block headerTitle %}{% if 'index' == tmpl %}{{ header }}{% endif %}{% endblock %}
{% block actions %}
{% if 'index' == tmpl %}
    {{ include(
        'MauticCoreBundle:Helper:page_actions.html.twig',
        {
                'item': report,
                'templateButtons': {
                    'edit': securityHasEntityAccess(
                        permissions['report:reports:editown'],
                        permissions['report:reports:editother'],
                        report.getCreatedBy()
                    ),
                    'delete': securityHasEntityAccess(
                        permissions['report:reports:deleteown'],
                        permissions['report:reports:deleteother'],
                        report.getCreatedBy()
                    ),
                    'close': securityHasEntityAccess(
                        permissions['report:reports:viewown'],
                        permissions['report:reports:viewother'],
                        report.getCreatedBy()
                    ),
                },
                'routeBase': 'report',
                'langVar': 'report.report',
                'customButtons': [],
        })
    }}
{% endif %}
{% endblock %}
{% block publishStatus %}
{% if 'index' == tmpl %}
    {{ include(
        'MauticCoreBundle:Helper:page_actions.html.twig',
        {
            'entity': report
        })
    }}
{% endif %}
{% endblock %}
{% block content %}

{% if report.getDescription() is not empty %}
<div class="pr-md pl-md pt-lg pb-lg">
    <div class="text-white dark-sm mb-0">{{ report.getDescription()|escape }}</div>
</div>
{% endif %}

<div id="report-shelves" class="mb-5" aria-multiselectable="true">
    <div class="collapse" id="report-details">
        <div class="pr-md pl-md pb-md">
            <div class="panel shd-none mb-0">
                <table class="table table-bordered table-striped mb-0">
                    <tbody>
                    {{ include(
                        'MauticCoreBundle:Helper:details.html.twig',
                        {'entity': report}
                    )
                    }}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="collapse<?php if ($showDynamicFilters): ?> in<?php endif; ?>" id="report-filters">
        <div class="pr-md pl-md pb-md">
            <div class="panel shd-none mb-0 pa-lg">
                <div class="row">
                    <div class="col-sm-12 mb-10<?php if ($hideDateRangeFilter):?> hide<?php endif; ?>">
                        {{ include('MauticCoreBundle:Helper:graph_dateselect.html.twig', {'dateRangeForm': dateRangeForm}) }}
                    </div>
                    {{ form_start(dynamicFilterForm) }}
                    {% for filter in dynamicFilterForm.children %}
                    {% if filter.vars.block_prefixes != 'hidden' %}
                    <div class="col-sm-4">
                        {{ form_row(filter) }}
                    </div>
                    {% endif %}
                    {% endfor %}
                    {{ form_end(dynamicFilterForm) }}
                </div>
            </div>
        </div>
    </div>
    

    <div class="bg-auto bg-dark-xs">
        
        <div class="hr-expand nm">
            <a href="#report-details" class="arrow text-muted collapsed" data-toggle="collapse" aria-expanded="false" aria-controls="report-details">
                <span class="caret"></span> {% trans %}mautic.core.details{% endtrans %}
            </a>
            <a href="#report-filters" class="arrow text-muted {% if showDynamicFilters is not empty %}collapsed{% endif %}" data-toggle="collapse" aria-expanded="false" aria-controls="report-filters">
                <span class="caret"></span> {% trans %}mautic.core.filters{% endtrans %}
            </a>
        </div>
        
    </div>
</div>

<div class="report-content">
    {{ slot('_content') }}
</div>
{% if debug is not empty and debug.count_query is defined %}
<div class="well">
    <h4>Debug: {{ debug.query_time }}</h4>
    <div>{{ debug.count_query }}</div>
    <br />
    <div>{{ debug.query }}</div>
</div>
{% endif %}
<input type="hidden" name="entityId" id="entityId" value="{{ report.getId()|escape }}"/>
{% endblock %}