<!-- timeline -->
<div class="table-responsive">
    <table class="table table-hover table-bordered" id="contact-timeline">
        <thead>
        <tr>
            <th class="timeline-icon">
                <a class="btn btn-sm btn-nospin btn-default" data-activate-details="all" data-toggle="tooltip" title="{{ 'mautic.lead.timeline.toggle_all_details'|trans }}">
                    <span class="fa fa-fw fa-level-down"></span>
                </a>
            </th>
            {{ include('MauticCoreBundle:Helper:tableheader.html.twig', {
                'orderBy': 'eventLabel',
                'text': 'mautic.lead.timeline.event_name',
                'class': 'timeline-name',
                'sessionVar': 'lead.'~lead.id~'.timeline',
                'baseUrl': path('mautic_contacttimeline_action', {'leadId': lead.id}),
                'target': '#timeline-table',
            }) }}

            {{ include('MauticCoreBundle:Helper:tableheader.html.twig', {
                'orderBy': 'eventType',
                'text': 'mautic.lead.timeline.event_type',
                'class': 'visible-md visible-lg timeline-type',
                'sessionVar': 'lead.'~lead.id~'.timeline',
                'baseUrl': path('mautic_contacttimeline_action', {'leadId': lead.id}),
                'target': '#timeline-table',
            }) }}

            {{ include('MauticCoreBundle:Helper:tableheader.html.twig', {
                'orderBy': 'timestamp',
                'text': 'mautic.lead.timeline.event_timestamp',
                'class': 'visible-md visible-lg timeline-timestamp',
                'sessionVar': 'lead.'~lead.id~'.timeline',
                'baseUrl': path('mautic_contacttimeline_action', {'leadId': lead.id}),
                'target': '#timeline-table',
            }) }}
        </tr>
        <tbody>
        {% for event in events.events %}
            {% set counter = loop.index0 + 1 %}
            {% set icon = event.icon|default('fa-history') %}
            {% set eventLabel = event.eventLabel|default(event.eventType) %}
            {% if eventLabel is iterable %}
                {% set linkType = eventLabel.isExternal is defined ? 'data-toggle="ajax"' : 'target="_new"' %}
                {% set eventLabel = '<a href="'~eventLabel.href~'" '~linkType~'>'~eventLabel.label~'</a>' %}
            {% endif %}
            <tr class="timeline-row {{ cycle(['', 'timeline-row-highlighted'], loop.index0) }} {% if event.featured is defined %}timeline-featured{% endif %}">
                <td class="timeline-icon">
                    <a href="javascript:void(0);" data-activate-details="{{ counter }}" class="btn btn-sm btn-nospin btn-default {% if event.contentTemplate is not defined %}disabled{% endif %}" data-toggle="tooltip" title="{{ 'mautic.lead.timeline.toggle_details'|trans }}">
                        <span class="fa fa-fw {{ icon }}"></span>
                    </a>
                </td>
                <td class="timeline-name">{{ eventLabel|purify }}</td>
                <td class="timeline-type">{{ event.eventType|default('') }}</td>
                <td class="timeline-timestamp">{{ dateToText(event.timestamp, 'local', 'Y-m-d H:i:s', true) }}</td>
            </tr>
            {% if event.contentTemplate is defined %}
                <!-- contentTemplate: "{{ event.contentTemplate }}" -->
                <tr class="timeline-row {{ cycle(['', 'timeline-row-highlighted'], loop.index0) }} timeline-details hide" id="timeline-details-{{ counter }}">
                    <td colspan="4">
                        {{ include(event.contentTemplate, {'event': event, 'lead': lead}) }}
                    </td>
                </tr>
            {% endif %}
        {% endfor %}
        </tbody>
    </table>
</div>
{{ include('MauticCoreBundle:Helper:pagination.html.twig', {
        'page': events.page,
        'fixedPages': events.maxPages,
        'fixedLimit': true,
        'baseUrl': path('mautic_contacttimeline_action', {'leadId': lead.id}),
        'target': '#timeline-table',
        'totalItems': events.total,
}) }}
<!--/ timeline -->
